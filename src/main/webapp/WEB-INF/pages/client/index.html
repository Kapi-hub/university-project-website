<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <meta charset="UTF-8">
    <title>Shotmaniacs</title>
    <link rel="icon" type="image/x-icon" href="/static/img/favicon3.ico">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" rel="stylesheet">
    <link href="/static/general.css" rel="stylesheet">
    <link href="/static/client/style.css" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/kiona-2" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-custom">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">
            <img alt="Logo" class="d-inline-block align-text-middle" width="30"
                 src="/static/img/Shotmaniacs_Logo_White_ZT.png">
            <span class="ps-3 LogoText color kiona">Shotmaniacs</span>
        </a>
        <ul class="nav justify-content-end ">

            <!--leave this in case we add another buttons-->
        </ul>
    </div>
</nav>
<div class="container-lg">

    <div class="main p-3">
        <p class="title kiona">Shotmaniacs</p>
        <p class="sub-title pb-5">
            "Shotmaniacs makes every shot count!" </p>
        <h2 class="heading">How it works</h2>
        <p>Below you can fill in the client. You must select one of the two pages to what you desire.</p>
    </div>
    <div class="container-sm form">
        <h2>Event Form</h2>
        <form>
            <!-- Client Details Section -->
            <h3 class="pt-4">Client Details</h3>
            <div class="form-group">
                <label for="forename">Forename</label>
                <input class="form-control" id="forename" placeholder="Enter forename" type="text">
            </div>
            <div class="form-group">
                <label for="surname">Surname</label>
                <input class="form-control" id="surname" placeholder="Enter surname" type="text">
            </div>
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input class="form-control" id="phone" placeholder="Enter phone number" type="tel">
            </div>
            <div class="form-group">
                <label for="email_address">Email Address</label>
                <input class="form-control" id="email_address" placeholder="Enter Email Address" type="text">
            </div>

            <!-- Event Details Section -->

            <h3 class="pt-4">Event Details</h3>
            <div>
                <label>
                    <input checked name="booking-type" onclick="showForm('single')" type="radio" value="single">
                    Single Booking
                </label>
                <label>
                    <input name="booking-type" onclick="showForm('multiple')" type="radio" value="multiple">
                    Multiple Bookings
                </label>
            </div>
            <div id="single">
                <div class="form-group">
                    <label for="name">Event Name</label>
                    <input class="form-control" id="name" placeholder="Enter event name" type="text">
                </div>
                <div class="form-group">
                    <label for="type">Event Type</label>
                    <select style="background-color: #1696D2" class="form-control select" id="type">
                        <option value="CLUB_PHOTOGRAPHY">Club Photography</option>
                        <option value="FESTIVAL">Festival</option>
                        <option value="PRODUCT_SHOOT">Product shoot</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="event-booking-type">Booking Type</label>
                    <select style="background-color: #1696D2" class="form-control select" id="event-booking-type">
                        <option value="PHOTOGRAPHY">Photography</option>
                        <option value="FILM">Film</option>
                        <option value="MARKETING">Marketing</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="start">Event Start</label>
                    <input class="form-control select" id="start" type="datetime-local">
                </div>
                <div class="form-group">
                    <label for="duration">Event Duration (in hours)</label>
                    <input class="form-control" id="duration" min="0" placeholder="Enter event duration" type="number">
                </div>
                <div class="form-group">
                    <label for="location">Event Location</label>
                    <input class="form-control" id="location" placeholder="Enter event location" type="text">
                </div>

                <!-- Required Crew Section -->
                <h3 class="pt-4">Required Crew</h3>
                <div class="form-group">
                    <label for="photographer">Photographer</label>
                    <input class="form-control" id="photographer" min="0"  placeholder="Enter required photographer count"
                           type="number">
                </div>
                <div class="form-group">
                    <label for="assistant">Assistant</label>
                    <input class="form-control" id="assistant" min="0" placeholder="Enter required assistant count"
                           type="number">
                </div>
                <div class="form-group">
                    <label for="editor">Editor</label>
                    <input class="form-control" id="editor" min="0" placeholder="Enter required editor count" type="number">
                </div>
                <div class="form-group">
                    <label for="data_handler">Data Handler</label>
                    <input class="form-control" id="data_handler" min="0" placeholder="Enter required data handler count"
                           type="number">
                </div>
                <div class="form-group">
                    <label for="planner">Planner</label>
                    <input class="form-control" id="planner" min="0" placeholder="Enter required planner count" type="number">
                </div>
                <div class="form-group">
                    <label for="producer">Producer</label>
                    <input class="form-control" id="producer" min="0" placeholder="Enter required producer count" type="number">
                </div>
                <div class="form-group">
                    <label for="videographer">Videographer</label>
                    <input class="form-control" id="videographer" min="0" placeholder="Enter required videographer count"
                           type="number">
                </div>
            </div>
            <div id="multiple">
                <div class="pt-3">For the booking, please fill out this template.
                    <a download href="/static/client/template/template.xlsx">(.xlsx)</a>
                    <a download href="/static/client/template/template.csv">(.csv)</a>
                </div>

                <div class="form-group">
                    <label for="excel_template">Upload form here<br></label>
                    <input accept=".xlsx, .xls, .csv" class="form-control-file" id="excel_template" type="file">
                </div>
            </div>
            <!-- Submit Button -->
            <button class="btn-primary btn submit-btn px-5 m-2 " type="submit">Submit</button>
        </form>
    </div>

</div>


</body>
<script>
    let single = true;

    function showForm(type) {
        if (type === 'single') {
            document.getElementById('single').style.display = 'block';
            document.getElementById('multiple').style.display = 'none';
            single = true;
        } else if (type === 'multiple') {
            document.getElementById('single').style.display = 'none';
            document.getElementById('multiple').style.display = 'block';
            single = false;
        }
    }

    $(document).ready(function () {
// Add event listener for form submission
        $("form").submit(function (event) {

            const requiredElements = ["forename", "surname", "phone", "email_address", // client
                "name", "type", "event-booking-type", "start", "duration", "location", // event
                "photographer", "assistant", "editor", "data_handler", "planner", "producer", "videographer"]; // requirements

            let unfilledElements = [];
            for (let i = 0; i < requiredElements.length; i++) {
                const el = $(`#${requiredElements[i]}`);
                if (!single && i >= 4) {
                    break;
                }
                if (el.val().length === 0) {
                    unfilledElements.push(requiredElements[i]);
                    el.css("border-bottom", "2px solid red");
                }
            }
            event.preventDefault(); // Prevent the default form submission
            if (unfilledElements.length > 0) {
                alert("Please fill in the details for " + unfilledElements);
            } else {
                if (single) {
// Get the form data
                    const formData = {
                        clientBean: {
                            forename: $("#forename").val(),
                            surname: $("#surname").val(),
                            phone_number: $("#phone").val(),
                            emailAddress: $("#email_address").val()
                        },
                        eventBean: {
                            name: $("#name").val(),
                            type: $("#type").val(),
                            booking_type: $("#event-booking-type").val(),
                            start: $("#start").val(),
                            duration: $("#duration").val(),
                            location: $("#location").val()
                        },
                        requiredCrewBeans: [
                            {
                                crew_size: $("#photographer").val(),
                                role: "PHOTOGRAPHER"
                            },
                            {
                                crew_size: $("#assistant").val(),
                                role: "ASSISTANT"
                            },
                            {
                                crew_size: $("#editor").val(),
                                role: "EDITOR"
                            },
                            {
                                crew_size: $("#data_handler").val(),
                                role: "DATA_HANDLER"
                            },
                            {
                                crew_size: $("#planner").val(),
                                role: "PLANNER"
                            },
                            {
                                crew_size: $("#producer").val(),
                                role: "PRODUCER"
                            },
                            {
                                crew_size: $("#videographer").val(),
                                role: "VIDEOGRAPHER"
                            }
                        ]
                    };
                    // Make the POST request
                    $.ajax({
                        url: "/api/client/submit-form/",
                        method: "POST",
                        dataType: "json",
                        contentType: "application/json",
                        data: JSON.stringify(formData),
                        success: function () {
                            alert("Form successfully sent!");
                        },
                        error: function () {
                            alert("An error has occurred");
                        }

                    });
                } else {
                    const formData = new FormData();
                    // formData.delete("booking-type");
                    const clientBean = {
                        forename: $('#forename').val(),
                        surname: $('#surname').val(),
                        phone_number: $('#phone').val(),
                        emailAddress: $('#email_address').val()
                    };
                    const fileInput = $('#excel_template')[0];
                    formData.append('client_data', JSON.stringify(clientBean));
                    formData.append('excel_template', fileInput.files[0]);
                    for (const entry of formData.entries()) {
                        console.log(entry);
                    }
                    $.ajax({
                        url: '/api/client/submit-form-multiple/',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function () {
                            alert('File uploaded successfully');
                        },
                        error: function () {
                            alert('File upload failed');
                        }
                    });
                }
            }
        });
    });
</script>
</html>

